<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.naver.client.repo.ChatMessageRepo">
	<select id="selectLastMessageAndAt" parameterType="int" resultType="lastmessageandat">
		select content as lastMessage, sentAt as lastAt from chatMessage where chatId = #{chatId} order by sentAt desc limit 1
	</select>
	
	<select id="selectUnReadCount" parameterType="int" resultType="int">
	select count(id) from chatMessage where sentAt > (select readtime from chatMember where chatId = #{chatId} and userId = #{userId})and chatId = #{chatId}
	</select>
	
	<insert id="insert" parameterType="chatmessage">
		insert into chatMessage(chatId,userId,content,sentAt,type) values(#{chatId},#{userId},#{content},#{sentAt},#{type})
	</insert>
	
	<select id="selectMessageVoNoOption" parameterType="int" resultType="chatmessagevo">
		select id,chatId,userId,content,sentAt,type from chatMessage where chatId=#{chatId} order by id DESC limit #{size}
	</select>
	
	<select id="selectMessageVoLastMessageIdOption" parameterType="int" resultType="chatmessagevo">
		select id,chatId,userId,content,sentAt,type from chatMessage where chatId=#{chatId} and id <![CDATA[ < ]]>	 #{lastMessageId} order by id DESC limit #{size}
	</select>
	
</mapper>